<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DG Store - Complete System with Purchases</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #0f172a;
            --accent: #3b82f6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #06b6d4;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #0f172a;
            --text-muted: #64748b;
            --border: #e2e8f0;
        }
        
        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }
        
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 260px;
            background: var(--primary);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            box-shadow: 4px 0 20px rgba(0,0,0,0.1);
        }
        
        .sidebar-header {
            padding: 32px 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .store-name {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .store-subtitle {
            font-size: 13px;
            opacity: 0.7;
        }
        
        .nav-menu {
            list-style: none;
            padding: 16px 0;
        }
        
        .nav-item {
            padding: 0 16px;
            margin-bottom: 4px;
        }
        
        .nav-button {
            width: 100%;
            padding: 12px 16px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.8);
            text-align: left;
            cursor: pointer;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .nav-button:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .nav-button.active {
            background: var(--accent);
            color: white;
        }
        
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 32px 40px;
        }
        
        .page-header {
            margin-bottom: 32px;
        }
        
        .page-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .page-subtitle {
            color: var(--text-muted);
            font-size: 15px;
        }
        
        .card {
            background: var(--card);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }
        
        .alert {
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        
        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #f59e0b;
        }
        
        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #3b82f6;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-family: inherit;
        }
        
        .btn-primary {
            background: var(--accent);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-secondary {
            background: var(--border);
            color: var(--text);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-info {
            background: var(--info);
            color: white;
        }
        
        .file-upload-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        
        .file-upload-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }
        
        .file-upload-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: var(--success);
            color: white;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .file-upload-label:hover {
            background: #059669;
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid var(--border);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        thead {
            background: var(--bg);
        }
        
        th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            color: var(--text-muted);
            text-transform: uppercase;
            border-bottom: 2px solid var(--border);
        }
        
        td {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
        }
        
        tbody tr:hover {
            background: var(--bg);
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .badge-info {
            background: #cffafe;
            color: #155e75;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }
        
        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }
        
        .search-bar {
            position: relative;
            margin-bottom: 24px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 15px;
        }
        
        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border);
            border-radius: 10px;
            overflow: hidden;
            margin: 12px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--success);
            transition: width 0.3s;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 15px;
            font-family: inherit;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }
        
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }
        
        .modal {
            background: white;
            border-radius: 20px;
            padding: 32px;
            max-width: 700px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 24px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--card) 0%, var(--bg) 100%);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border);
            transition: transform 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
        }
        
        .stat-label {
            font-size: 13px;
            color: var(--text-muted);
            font-weight: 500;
            text-transform: uppercase;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: 700;
            font-family: monospace;
        }
        
        .tab-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            border-bottom: 2px solid var(--border);
            padding-bottom: 0;
        }
        
        .tab-button {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--text-muted);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: -2px;
        }
        
        .tab-button.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }
        
        .tab-button:hover {
            color: var(--text);
        }
        
        .comparison-table {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 2px;
            background: var(--border);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .comparison-cell {
            background: white;
            padding: 16px;
        }
        
        .comparison-header {
            background: var(--bg);
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            color: var(--text-muted);
        }
        
        .price-change {
            font-size: 12px;
            font-weight: 600;
            margin-top: 4px;
        }
        
        .price-up {
            color: var(--danger);
        }
        
        .price-down {
            color: var(--success);
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: relative;
                height: auto;
            }
            .main-content {
                margin-left: 0;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // LOCAL STORAGE KEYS
        const KEYS = {
            products: 'dgstore_products',
            sales: 'dgstore_sales',
            purchases: 'dgstore_purchases',
            suppliers: 'dgstore_suppliers',
            lastBackup: 'dgstore_last_backup',
            categories: 'dgstore_categories'
        };
        
        const saveToLocal = (key, data) => {
            localStorage.setItem(key, JSON.stringify(data));
        };
        
        const loadFromLocal = (key, defaultValue = []) => {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : defaultValue;
        };

        function App() {
            const [currentPage, setCurrentPage] = useState('dashboard');
            const [products, setProducts] = useState([]);
            const [sales, setSales] = useState([]);
            const [purchases, setPurchases] = useState([]);
            const [suppliers, setSuppliers] = useState([]);
            const [categories, setCategories] = useState([]);

            useEffect(() => {
                setProducts(loadFromLocal(KEYS.products));
                setSales(loadFromLocal(KEYS.sales));
                setPurchases(loadFromLocal(KEYS.purchases));
                setSuppliers(loadFromLocal(KEYS.suppliers));
                setCategories(loadFromLocal(KEYS.categories, ['Food', 'Beverages', 'Personal Care', 'Household', 'Snacks', 'General']));
            }, []);

            useEffect(() => {
                if (products.length > 0) saveToLocal(KEYS.products, products);
            }, [products]);

            useEffect(() => {
                if (sales.length > 0) saveToLocal(KEYS.sales, sales);
            }, [sales]);

            useEffect(() => {
                if (purchases.length > 0) saveToLocal(KEYS.purchases, purchases);
            }, [purchases]);

            useEffect(() => {
                if (suppliers.length > 0) saveToLocal(KEYS.suppliers, suppliers);
            }, [suppliers]);

            return (
                <div className="app-container">
                    <aside className="sidebar">
                        <div className="sidebar-header">
                            <div className="store-name">DG Store</div>
                            <div className="store-subtitle">üè™ Complete System</div>
                        </div>
                        <nav>
                            <ul className="nav-menu">
                                {[
                                    {id: 'dashboard', icon: 'üìä', label: 'Dashboard'},
                                    {id: 'products', icon: 'üì¶', label: 'Products'},
                                    {id: 'sales', icon: 'üí∞', label: 'Sales'},
                                    {id: 'purchases', icon: 'üõí', label: 'Purchases'},
                                    {id: 'reorder', icon: 'üìã', label: 'Reorder Sheet'},
                                    {id: 'suppliers', icon: 'üè≠', label: 'Suppliers'},
                                    {id: 'reports', icon: 'üìà', label: 'Reports'},
                                    {id: 'backup', icon: 'üíæ', label: 'Backup'}
                                ].map(item => (
                                    <li key={item.id} className="nav-item">
                                        <button 
                                            className={`nav-button ${currentPage === item.id ? 'active' : ''}`}
                                            onClick={() => setCurrentPage(item.id)}
                                        >
                                            {item.icon} {item.label}
                                        </button>
                                    </li>
                                ))}
                            </ul>
                        </nav>
                    </aside>

                    <main className="main-content">
                        {currentPage === 'dashboard' && <Dashboard products={products} sales={sales} purchases={purchases} />}
                        {currentPage === 'products' && <Products products={products} setProducts={setProducts} categories={categories} />}
                        {currentPage === 'sales' && <Sales products={products} sales={sales} setSales={setSales} setProducts={setProducts} />}
                        {currentPage === 'purchases' && <Purchases products={products} purchases={purchases} setPurchases={setPurchases} setProducts={setProducts} suppliers={suppliers} />}
                        {currentPage === 'reorder' && <ReorderSheet products={products} purchases={purchases} />}
                        {currentPage === 'suppliers' && <Suppliers suppliers={suppliers} setSuppliers={setSuppliers} />}
                        {currentPage === 'reports' && <Reports products={products} sales={sales} purchases={purchases} />}
                        {currentPage === 'backup' && <Backup products={products} setProducts={setProducts} sales={sales} setSales={setSales} purchases={purchases} setPurchases={setPurchases} suppliers={suppliers} setSuppliers={setSuppliers} />}
                    </main>
                </div>
            );
        }

        // Dashboard Component (keeping simple version)
        function Dashboard({ products, sales, purchases }) {
            const totalProducts = products.length;
            const totalStock = products.reduce((sum, p) => sum + (p.quantity || 0), 0);
            const lowStockItems = products.filter(p => p.quantity <= (p.reorderLevel || 5)).length;
            const totalSalesAmount = sales.reduce((sum, s) => sum + (s.total || 0), 0);
            const totalPurchasesAmount = purchases.reduce((sum, p) => sum + (p.total || 0), 0);

            return (
                <div>
                    <div className="page-header">
                        <h1 className="page-title">Dashboard</h1>
                        <p className="page-subtitle">Business Overview</p>
                    </div>

                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-label">Total Products</div>
                            <div className="stat-value">{totalProducts}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Total Stock</div>
                            <div className="stat-value">{totalStock}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Low Stock</div>
                            <div className="stat-value" style={{color: 'var(--warning)'}}>{lowStockItems}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Total Sales</div>
                            <div className="stat-value">‚Çπ{totalSalesAmount.toFixed(2)}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Total Purchases</div>
                            <div className="stat-value">‚Çπ{totalPurchasesAmount.toFixed(2)}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Transactions</div>
                            <div className="stat-value">{sales.length + purchases.length}</div>
                        </div>
                    </div>
                </div>
            );
        }

        // Products Component (simplified version)
        function Products({ products, setProducts, categories }) {
            const [searchTerm, setSearchTerm] = useState('');
            const [importStatus, setImportStatus] = useState('');
            const [importProgress, setImportProgress] = useState(0);

            const filteredProducts = products.filter(p =>
                p.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                p.sku?.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const handleQuickUpdate = (id, field, value) => {
                setProducts(products.map(p => 
                    p.id === id ? { ...p, [field]: field === 'quantity' ? parseInt(value) || 0 : parseFloat(value) || 0 } : p
                ));
            };

            const handleExcelImport = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                setImportStatus('üìñ Reading...');
                setImportProgress(0);

                try {
                    const reader = new FileReader();
                    
                    reader.onload = async (event) => {
                        try {
                            const data = new Uint8Array(event.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                            const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                            if (jsonData.length === 0) {
                                alert('No data found');
                                setImportStatus('');
                                return;
                            }

                            setImportStatus(`Importing ${jsonData.length} products...`);

                            const newProducts = [];
                            let imported = 0;
                            let updated = 0;
                            let skipped = 0;

                            for (let i = 0; i < jsonData.length; i++) {
                                const row = jsonData[i];
                                
                                try {
                                    const product = {
                                        sku: row.SKU || row.sku || `AUTO-${Date.now()}-${i}`,
                                        name: row.Name || row.name || '',
                                        category: row.Category || row.category || 'General',
                                        description: row.Description || row.description || '',
                                        price: parseFloat(row.Price || row.price || row['Selling Price'] || 0),
                                        costPrice: parseFloat(row['Cost Price'] || row.costPrice || 0),
                                        quantity: parseInt(row.Quantity || row.quantity || 0),
                                        reorderLevel: parseInt(row['Reorder Level'] || row.reorderLevel || 5),
                                        unit: row.Unit || row.unit || 'pcs'
                                    };

                                    if (!product.name) {
                                        skipped++;
                                        continue;
                                    }

                                    const existingIndex = products.findIndex(p => p.sku === product.sku);
                                    if (existingIndex >= 0) {
                                        products[existingIndex] = { ...products[existingIndex], ...product };
                                        updated++;
                                    } else {
                                        newProducts.push({ ...product, id: Date.now() + i });
                                        imported++;
                                    }

                                    const progress = ((i + 1) / jsonData.length) * 100;
                                    setImportProgress(progress);

                                } catch (error) {
                                    skipped++;
                                }
                            }

                            setProducts([...products, ...newProducts]);
                            setImportStatus(`‚úÖ Done! Added: ${imported}, Updated: ${updated}, Skipped: ${skipped}`);
                            setImportProgress(100);
                            
                            setTimeout(() => {
                                setImportStatus('');
                                setImportProgress(0);
                            }, 5000);

                        } catch (error) {
                            alert('Error: ' + error.message);
                            setImportStatus('');
                        }
                    };

                    reader.readAsArrayBuffer(file);
                } catch (error) {
                    alert('Error: ' + error.message);
                    setImportStatus('');
                }

                e.target.value = '';
            };

            const handleExport = () => {
                if (products.length === 0) {
                    alert('No products to export');
                    return;
                }

                const data = products.map(p => ({
                    'SKU': p.sku,
                    'Name': p.name,
                    'Category': p.category || '',
                    'Cost Price': p.costPrice || 0,
                    'Selling Price': p.price || 0,
                    'Quantity': p.quantity || 0,
                    'Reorder Level': p.reorderLevel || 5,
                    'Unit': p.unit || 'pcs'
                }));

                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Products');
                XLSX.writeFile(wb, `Products-${new Date().toISOString().split('T')[0]}.xlsx`);
            };

            return (
                <div>
                    <div className="page-header">
                        <h1 className="page-title">Products ({products.length})</h1>
                        <p className="page-subtitle">Quick edit inventory</p>
                    </div>

                    {importStatus && (
                        <div className="alert alert-info">
                            <div style={{flex: 1}}>
                                <div><strong>{importStatus}</strong></div>
                                {importProgress > 0 && (
                                    <div className="progress-bar">
                                        <div className="progress-fill" style={{width: `${importProgress}%`}}></div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '24px', gap: '16px'}}>
                        <div className="search-bar" style={{flex: 1, maxWidth: '400px', margin: 0}}>
                            <span className="search-icon">üîç</span>
                            <input
                                type="text"
                                className="search-input"
                                placeholder="Search products..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                        </div>
                        <div style={{display: 'flex', gap: '12px'}}>
                            <div className="file-upload-wrapper">
                                <input type="file" id="excel-import" accept=".xlsx,.xls" onChange={handleExcelImport} />
                                <label htmlFor="excel-import" className="file-upload-label">üìä Import</label>
                            </div>
                            <button className="btn btn-success" onClick={handleExport}>üì§ Export</button>
                        </div>
                    </div>

                    <div className="card">
                        {filteredProducts.length > 0 ? (
                            <div className="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>SKU</th>
                                            <th>Name</th>
                                            <th>Category</th>
                                            <th>Price</th>
                                            <th>Quantity</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {filteredProducts.map(p => (
                                            <tr key={p.id}>
                                                <td><code>{p.sku}</code></td>
                                                <td><strong>{p.name}</strong></td>
                                                <td>{p.category}</td>
                                                <td>
                                                    <input
                                                        type="number"
                                                        step="0.01"
                                                        value={p.price}
                                                        onChange={(e) => handleQuickUpdate(p.id, 'price', e.target.value)}
                                                        style={{width: '80px', padding: '4px 8px', border: '1px solid var(--border)', borderRadius: '6px'}}
                                                    />
                                                </td>
                                                <td>
                                                    <input
                                                        type="number"
                                                        value={p.quantity}
                                                        onChange={(e) => handleQuickUpdate(p.id, 'quantity', e.target.value)}
                                                        style={{width: '70px', padding: '4px 8px', border: '1px solid var(--border)', borderRadius: '6px'}}
                                                    />
                                                </td>
                                                <td>
                                                    {p.quantity === 0 ? (
                                                        <span className="badge badge-danger">Out</span>
                                                    ) : p.quantity <= (p.reorderLevel || 5) ? (
                                                        <span className="badge badge-warning">Low</span>
                                                    ) : (
                                                        <span className="badge badge-success">OK</span>
                                                    )}
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <div className="empty-state">
                                <div className="empty-state-icon">üì¶</div>
                                <p>No products found</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Sales Component (keeping simple)
        function Sales({ products, sales, setSales, setProducts }) {
            return (
                <div>
                    <div className="page-header">
                        <h1 className="page-title">Sales ({sales.length})</h1>
                        <p className="page-subtitle">Sales tracking</p>
                    </div>
                    <div className="card">
                        <div className="empty-state">
                            <div className="empty-state-icon">üí∞</div>
                            <p>Sales module - Use complete version for full features</p>
                        </div>
                    </div>
                </div>
            );
        }

        // NEW: Purchases Component
        function Purchases({ products, purchases, setPurchases, setProducts, suppliers }) {
            const [showModal, setShowModal] = useState(false);
            const [activeTab, setActiveTab] = useState('all');

            const handleDeletePurchase = (id) => {
                if (!confirm('Delete this purchase?')) return;
                
                const purchase = purchases.find(p => p.id === id);
                if (purchase) {
                    // Remove stock
                    const updatedProducts = [...products];
                    purchase.items.forEach(item => {
                        const productIndex = updatedProducts.findIndex(p => p.id === item.productId);
                        if (productIndex >= 0) {
                            updatedProducts[productIndex].quantity -= item.quantity;
                        }
                    });
                    setProducts(updatedProducts);
                }
                
                setPurchases(purchases.filter(p => p.id !== id));
            };

            const exportPurchases = () => {
                if (purchases.length === 0) {
                    alert('No purchases to export');
                    return;
                }

                const data = purchases.map(p => ({
                    'Date': new Date(p.date).toLocaleString(),
                    'Supplier': p.supplierName || 'N/A',
                    'Invoice No': p.invoiceNo || '',
                    'Items': p.items.length,
                    'Total': p.total,
                    'Payment': p.paymentStatus
                }));

                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Purchases');
                XLSX.writeFile(wb, `Purchases-${new Date().toISOString().split('T')[0]}.xlsx`);
            };

            const filteredPurchases = activeTab === 'all' 
                ? purchases 
                : purchases.filter(p => {
                    const date = new Date(p.date);
                    const now = new Date();
                    if (activeTab === 'today') return date.toDateString() === now.toDateString();
                    if (activeTab === 'week') {
                        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        return date >= weekAgo;
                    }
                    if (activeTab === 'month') {
                        return date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear();
                    }
                    return true;
                });

            return (
                <div>
                    <div className="page-header">
                        <h1 className="page-title">Purchase History ({purchases.length})</h1>
                        <p className="page-subtitle">Track all inventory purchases</p>
                    </div>

                    <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '24px', gap: '16px'}}>
                        <div className="tab-buttons">
                            <button className={`tab-button ${activeTab === 'all' ? 'active' : ''}`} onClick={() => setActiveTab('all')}>
                                All
                            </button>
                            <button className={`tab-button ${activeTab === 'today' ? 'active' : ''}`} onClick={() => setActiveTab('today')}>
                                Today
                            </button>
                            <button className={`tab-button ${activeTab === 'week' ? 'active' : ''}`} onClick={() => setActiveTab('week')}>
                                This Week
                            </button>
                            <button className={`tab-button ${activeTab === 'month' ? 'active' : ''}`} onClick={() => setActiveTab('month')}>
                                This Month
                            </button>
                        </div>
                        <div style={{display: 'flex', gap: '12px'}}>
                            <button className="btn btn-success" onClick={exportPurchases}>üì§ Export</button>
                            <button className="btn btn-primary" onClick={() => setShowModal(true)}>‚ûï New Purchase</button>
                        </div>
                    </div>

                    <div className="card">
                        {filteredPurchases.length > 0 ? (
                            <div className="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Supplier</th>
                                            <th>Invoice No</th>
                                            <th>Items</th>
                                            <th>Total</th>
                                            <th>Payment</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {filteredPurchases.slice().reverse().map(purchase => (
                                            <tr key={purchase.id}>
                                                <td>{new Date(purchase.date).toLocaleString()}</td>
                                                <td><strong>{purchase.supplierName || 'N/A'}</strong></td>
                                                <td><code>{purchase.invoiceNo || '-'}</code></td>
                                                <td>{purchase.items?.length || 0} items</td>
                                                <td><strong>‚Çπ{purchase.total.toFixed(2)}</strong></td>
                                                <td>
                                                    <span className={`badge ${purchase.paymentStatus === 'Paid' ? 'badge-success' : 'badge-warning'}`}>
                                                        {purchase.paymentStatus}
                                                    </span>
                                                </td>
                                                <td>
                                                    <button 
                                                        className="btn btn-danger"
                                                        style={{padding: '6px 12px', fontSize: '13px'}}
                                                        onClick={() => handleDeletePurchase(purchase.id)}
                                                    >
                                                        üóëÔ∏è
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <div className="empty-state">
                                <div className="empty-state-icon">üõí</div>
                                <p>No purchases recorded yet</p>
                            </div>
                        )}
                    </div>

                    {showModal && (
                        <PurchaseModal
                            products={products}
                            suppliers={suppliers}
                            onClose={() => setShowModal(false)}
                            onSave={(purchase) => {
                                // Add stock
                                const updatedProducts = [...products];
                                purchase.items.forEach(item => {
                                    const productIndex = updatedProducts.findIndex(p => p.id === item.productId);
                                    if (productIndex >= 0) {
                                        updatedProducts[productIndex].quantity += item.quantity;
                                        // Update cost price if provided
                                        if (item.costPrice) {
                                            updatedProducts[productIndex].costPrice = item.costPrice;
                                        }
                                    }
                                });
                                setProducts(updatedProducts);
                                
                                // Add purchase
                                setPurchases([...purchases, { ...purchase, id: Date.now(), date: new Date().toISOString() }]);
                                setShowModal(false);
                            }}
                        />
                    )}
                </div>
            );
        }

        // Purchase Modal
        function PurchaseModal({ products, suppliers, onClose, onSave }) {
            const [supplierName, setSupplierName] = useState('');
            const [invoiceNo, setInvoiceNo] = useState('');
            const [paymentStatus, setPaymentStatus] = useState('Paid');
            const [items, setItems] = useState([]);

            const addItem = () => {
                setItems([...items, { productId: '', quantity: 1, costPrice: 0 }]);
            };

            const removeItem = (index) => {
                setItems(items.filter((_, i) => i !== index));
            };

            const updateItem = (index, field, value) => {
                const updated = [...items];
                updated[index][field] = value;
                
                if (field === 'productId') {
                    const product = products.find(p => p.id === parseInt(value));
                    if (product) {
                        updated[index].costPrice = product.costPrice || 0;
                        updated[index].productName = product.name;
                    }
                }
                
                setItems(updated);
            };

            const calculateTotal = () => {
                return items.reduce((sum, item) => sum + (item.quantity * item.costPrice), 0);
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (items.length === 0) {
                    alert('Please add at least one item');
                    return;
                }
                
                onSave({
                    supplierName,
                    invoiceNo,
                    paymentStatus,
                    items,
                    total: calculateTotal()
                });
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={(e) => e.stopPropagation()}>
                        <h2 className="modal-title">New Purchase</h2>
                        <form onSubmit={handleSubmit}>
                            <div className="form-grid">
                                <div className="form-group">
                                    <label className="form-label">Supplier</label>
                                    <select
                                        className="form-select"
                                        value={supplierName}
                                        onChange={(e) => setSupplierName(e.target.value)}
                                    >
                                        <option value="">Select Supplier</option>
                                        {suppliers.map(s => (
                                            <option key={s.id} value={s.name}>{s.name}</option>
                                        ))}
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Invoice No</label>
                                    <input
                                        type="text"
                                        className="form-input"
                                        value={invoiceNo}
                                        onChange={(e) => setInvoiceNo(e.target.value)}
                                        placeholder="INV-001"
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Payment Status</label>
                                    <select
                                        className="form-select"
                                        value={paymentStatus}
                                        onChange={(e) => setPaymentStatus(e.target.value)}
                                    >
                                        <option value="Paid">Paid</option>
                                        <option value="Pending">Pending</option>
                                        <option value="Partial">Partial</option>
                                    </select>
                                </div>
                            </div>

                            <h3 style={{marginTop: '24px', marginBottom: '16px', fontSize: '18px'}}>Items</h3>

                            {items.map((item, index) => (
                                <div key={index} style={{marginBottom: '16px', padding: '16px', background: 'var(--bg)', borderRadius: '10px'}}>
                                    <div className="form-grid">
                                        <div className="form-group" style={{marginBottom: 0}}>
                                            <label className="form-label">Product</label>
                                            <select
                                                className="form-select"
                                                value={item.productId}
                                                onChange={(e) => updateItem(index, 'productId', e.target.value)}
                                                required
                                            >
                                                <option value="">Select</option>
                                                {products.map(p => (
                                                    <option key={p.id} value={p.id}>{p.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div className="form-group" style={{marginBottom: 0}}>
                                            <label className="form-label">Quantity</label>
                                            <input
                                                type="number"
                                                className="form-input"
                                                value={item.quantity}
                                                onChange={(e) => updateItem(index, 'quantity', parseInt(e.target.value))}
                                                min="1"
                                                required
                                            />
                                        </div>
                                        <div className="form-group" style={{marginBottom: 0}}>
                                            <label className="form-label">Cost Price</label>
                                            <input
                                                type="number"
                                                step="0.01"
                                                className="form-input"
                                                value={item.costPrice}
                                                onChange={(e) => updateItem(index, 'costPrice', parseFloat(e.target.value))}
                                                required
                                            />
                                        </div>
                                    </div>
                                    <button
                                        type="button"
                                        className="btn btn-danger"
                                        style={{marginTop: '12px', padding: '6px 12px', fontSize: '13px'}}
                                        onClick={() => removeItem(index)}
                                    >
                                        üóëÔ∏è Remove
                                    </button>
                                </div>
                            ))}

                            <button type="button" className="btn btn-secondary" onClick={addItem} style={{marginBottom: '24px'}}>
                                ‚ûï Add Item
                            </button>

                            <div style={{padding: '20px', background: 'var(--bg)', borderRadius: '10px', marginBottom: '24px'}}>
                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                    <span style={{fontSize: '18px', fontWeight: '600'}}>Total:</span>
                                    <span style={{fontSize: '28px', fontWeight: '700', fontFamily: 'monospace'}}>
                                        ‚Çπ{calculateTotal().toFixed(2)}
                                    </span>
                                </div>
                            </div>

                            <div style={{display: 'flex', gap: '12px'}}>
                                <button type="submit" className="btn btn-primary" disabled={items.length === 0}>
                                    üõí Save Purchase
                                </button>
                                <button type="button" className="btn btn-secondary" onClick={onClose}>
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // NEW: Reorder Sheet Component
        function ReorderSheet({ products, purchases }) {
            const [selectedProducts, setSelectedProducts] = useState([]);

            const lowStockProducts = products.filter(p => p.quantity <= (p.reorderLevel || 5));

            const toggleProduct = (id) => {
                setSelectedProducts(prev => 
                    prev.includes(id) ? prev.filter(pid => pid !== id) : [...prev, id]
                );
            };

            const toggleAll = () => {
                if (selectedProducts.length === lowStockProducts.length) {
                    setSelectedProducts([]);
                } else {
                    setSelectedProducts(lowStockProducts.map(p => p.id));
                }
            };

            const getLastPurchase = (productId) => {
                const productPurchases = purchases.filter(p => 
                    p.items.some(item => item.productId === productId)
                );
                
                if (productPurchases.length === 0) return null;
                
                const sorted = productPurchases.sort((a, b) => 
                    new Date(b.date) - new Date(a.date)
                );
                
                const lastPurchase = sorted[0];
                const item = lastPurchase.items.find(i => i.productId === productId);
                
                return {
                    date: new Date(lastPurchase.date),
                    quantity: item.quantity,
                    costPrice: item.costPrice,
                    supplier: lastPurchase.supplierName
                };
            };

            const getPriceComparison = (productId) => {
                const productPurchases = purchases.filter(p => 
                    p.items.some(item => item.productId === productId)
                ).sort((a, b) => new Date(b.date) - new Date(a.date));

                if (productPurchases.length < 2) return null;

                const latest = productPurchases[0].items.find(i => i.productId === productId);
                const previous = productPurchases[1].items.find(i => i.productId === productId);

                if (!latest || !previous) return null;

                const change = latest.costPrice - previous.costPrice;
                const changePercent = (change / previous.costPrice) * 100;

                return { change, changePercent, previous: previous.costPrice, latest: latest.costPrice };
            };

            const exportReorderSheet = () => {
                if (selectedProducts.length === 0) {
                    alert('Please select products to reorder');
                    return;
                }

                const data = selectedProducts.map(id => {
                    const product = products.find(p => p.id === id);
                    const lastPurchase = getLastPurchase(id);
                    const reorderQty = Math.max(20, (product.reorderLevel || 5) * 3);

                    return {
                        'SKU': product.sku,
                        'Product Name': product.name,
                        'Current Stock': product.quantity,
                        'Reorder Level': product.reorderLevel || 5,
                        'Suggested Qty': reorderQty,
                        'Last Price': lastPurchase ? lastPurchase.costPrice : product.costPrice,
                        'Est. Total': lastPurchase ? (lastPurchase.costPrice * reorderQty).toFixed(2) : (product.costPrice * reorderQty).toFixed(2),
                        'Last Supplier': lastPurchase ? lastPurchase.supplier : 'N/A',
                        'Unit': product.unit
                    };
                });

                const ws = XLSX.utils.json_to_sheet(data);
                ws['!cols'] = [
                    { wch: 12 }, { wch: 30 }, { wch: 12 }, { wch: 12 },
                    { wch: 12 }, { wch: 12 }, { wch: 12 }, { wch: 20 }, { wch: 8 }
                ];

                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Reorder Sheet');
                XLSX.writeFile(wb, `Reorder-Sheet-${new Date().toISOString().split('T')[0]}.xlsx`);
            };

            return (
                <div>
                    <div className="page-header">
                        <h1 className="page-title">Reorder Sheet</h1>
                        <p className="page-subtitle">Low stock items needing reorder ({lowStockProducts.length})</p>
                    </div>

                    {lowStockProducts.length === 0 ? (
                        <div className="alert alert-success">
                            <span>‚úÖ</span>
                            <span><strong>All stock levels are good!</strong> No items need reordering.</span>
                        </div>
                    ) : (
                        <>
                            <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '24px'}}>
                                <button className="btn btn-secondary" onClick={toggleAll}>
                                    {selectedProducts.length === lowStockProducts.length ? '‚òê Deselect All' : '‚òë Select All'}
                                </button>
                                <button 
                                    className="btn btn-success" 
                                    onClick={exportReorderSheet}
                                    disabled={selectedProducts.length === 0}
                                >
                                    üì§ Export Reorder Sheet ({selectedProducts.length})
                                </button>
                            </div>

                            <div className="card">
                                <div className="table-container">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th style={{width: '40px'}}>‚òë</th>
                                                <th>SKU</th>
                                                <th>Product</th>
                                                <th>Current</th>
                                                <th>Reorder Qty</th>
                                                <th>Last Price</th>
                                                <th>Comparison</th>
                                                <th>Supplier</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {lowStockProducts.map(product => {
                                                const lastPurchase = getLastPurchase(product.id);
                                                const priceComp = getPriceComparison(product.id);
                                                const reorderQty = Math.max(20, (product.reorderLevel || 5) * 3);

                                                return (
                                                    <tr key={product.id}>
                                                        <td>
                                                            <input
                                                                type="checkbox"
                                                                checked={selectedProducts.includes(product.id)}
                                                                onChange={() => toggleProduct(product.id)}
                                                                style={{width: '18px', height: '18px', cursor: 'pointer'}}
                                                            />
                                                        </td>
                                                        <td><code>{product.sku}</code></td>
                                                        <td><strong>{product.name}</strong></td>
                                                        <td>
                                                            <span className={`badge ${product.quantity === 0 ? 'badge-danger' : 'badge-warning'}`}>
                                                                {product.quantity}
                                                            </span>
                                                        </td>
                                                        <td><strong>{reorderQty}</strong> {product.unit}</td>
                                                        <td>
                                                            ‚Çπ{lastPurchase ? lastPurchase.costPrice.toFixed(2) : product.costPrice.toFixed(2)}
                                                        </td>
                                                        <td>
                                                            {priceComp ? (
                                                                <div>
                                                                    <div className={`price-change ${priceComp.change > 0 ? 'price-up' : 'price-down'}`}>
                                                                        {priceComp.change > 0 ? '‚Üë' : '‚Üì'} ‚Çπ{Math.abs(priceComp.change).toFixed(2)}
                                                                    </div>
                                                                    <div style={{fontSize: '11px', color: 'var(--text-muted)'}}>
                                                                        ({priceComp.changePercent > 0 ? '+' : ''}{priceComp.changePercent.toFixed(1)}%)
                                                                    </div>
                                                                </div>
                                                            ) : (
                                                                <span style={{fontSize: '12px', color: 'var(--text-muted)'}}>No history</span>
                                                            )}
                                                        </td>
                                                        <td>
                                                            {lastPurchase ? (
                                                                <div>
                                                                    <div style={{fontSize: '13px'}}>{lastPurchase.supplier}</div>
                                                                    <div style={{fontSize: '11px', color: 'var(--text-muted)'}}>
                                                                        {lastPurchase.date.toLocaleDateString()}
                                                                    </div>
                                                                </div>
                                                            ) : (
                                                                '-'
                                                            )}
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </>
                    )}
                </div>
            );
        }

        // Suppliers Component
        function Suppliers({ suppliers, setSuppliers }) {
            const [showModal, setShowModal] = useState(false);
            const [editingSupplier, setEditingSupplier] = useState(null);

            const handleDelete = (id) => {
                if (!confirm('Delete supplier?')) return;
                setSuppliers(suppliers.filter(s => s.id !== id));
            };

            return (
                <div>
                    <div className="page-header">
                        <h1 className="page-title">Suppliers ({suppliers.length})</h1>
                        <p className="page-subtitle">Manage supplier contacts</p>
                    </div>

                    <button className="btn btn-primary" onClick={() => { setEditingSupplier(null); setShowModal(true); }} style={{marginBottom: '24px'}}>
                        ‚ûï Add Supplier
                    </button>

                    <div className="card">
                        {suppliers.length > 0 ? (
                            <div className="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Contact</th>
                                            <th>Phone</th>
                                            <th>Email</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {suppliers.map(s => (
                                            <tr key={s.id}>
                                                <td><strong>{s.name}</strong></td>
                                                <td>{s.contactPerson || '-'}</td>
                                                <td>{s.phone || '-'}</td>
                                                <td>{s.email || '-'}</td>
                                                <td>
                                                    <div style={{display: 'flex', gap: '8px'}}>
                                                        <button 
                                                            className="btn btn-secondary"
                                                            style={{padding: '6px 12px', fontSize: '13px'}}
                                                            onClick={() => { setEditingSupplier(s); setShowModal(true); }}
                                                        >
                                                            ‚úèÔ∏è
                                                        </button>
                                                        <button 
                                                            className="btn btn-danger"
                                                            style={{padding: '6px 12px', fontSize: '13px'}}
                                                            onClick={() => handleDelete(s.id)}
                                                        >
                                                            üóëÔ∏è
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <div className="empty-state">
                                <div className="empty-state-icon">üè≠</div>
                                <p>No suppliers added yet</p>
                            </div>
                        )}
                    </div>

                    {showModal && (
                        <SupplierModal
                            supplier={editingSupplier}
                            onClose={() => setShowModal(false)}
                            onSave={(supplier) => {
                                if (editingSupplier) {
                                    setSuppliers(suppliers.map(s => s.id === editingSupplier.id ? { ...s, ...supplier } : s));
                                } else {
                                    setSuppliers([...suppliers, { ...supplier, id: Date.now() }]);
                                }
                                setShowModal(false);
                            }}
                        />
                    )}
                </div>
            );
        }

        // Supplier Modal
        function SupplierModal({ supplier, onClose, onSave }) {
            const [form, setForm] = useState(supplier || {
                name: '',
                contactPerson: '',
                phone: '',
                email: '',
                address: ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(form);
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={(e) => e.stopPropagation()}>
                        <h2 className="modal-title">{supplier ? 'Edit Supplier' : 'Add Supplier'}</h2>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label className="form-label">Supplier Name *</label>
                                <input
                                    type="text"
                                    className="form-input"
                                    value={form.name}
                                    onChange={(e) => setForm({...form, name: e.target.value})}
                                    required
                                />
                            </div>
                            <div className="form-grid">
                                <div className="form-group">
                                    <label className="form-label">Contact Person</label>
                                    <input
                                        type="text"
                                        className="form-input"
                                        value={form.contactPerson}
                                        onChange={(e) => setForm({...form, contactPerson: e.target.value})}
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Phone</label>
                                    <input
                                        type="tel"
                                        className="form-input"
                                        value={form.phone}
                                        onChange={(e) => setForm({...form, phone: e.target.value})}
                                    />
                                </div>
                            </div>
                            <div className="form-group">
                                <label className="form-label">Email</label>
                                <input
                                    type="email"
                                    className="form-input"
                                    value={form.email}
                                    onChange={(e) => setForm({...form, email: e.target.value})}
                                />
                            </div>
                            <div className="form-group">
                                <label className="form-label">Address</label>
                                <textarea
                                    className="form-textarea"
                                    value={form.address}
                                    onChange={(e) => setForm({...form, address: e.target.value})}
                                />
                            </div>
                            <div style={{display: 'flex', gap: '12px', marginTop: '24px'}}>
                                <button type="submit" className="btn btn-primary">
                                    üíæ Save
                                </button>
                                <button type="button" className="btn btn-secondary" onClick={onClose}>
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Reports Component (simplified)
        function Reports({ products, sales, purchases }) {
            const totalRevenue = sales.reduce((sum, s) => sum + s.total, 0);
            const totalPurchases = purchases.reduce((sum, p) => sum + p.total, 0);

            const exportReport = () => {
                const reportData = [
                    ['DG STORE - BUSINESS REPORT'],
                    ['Generated:', new Date().toLocaleString()],
                    [],
                    ['SUMMARY'],
                    ['Total Revenue', `‚Çπ${totalRevenue.toFixed(2)}`],
                    ['Total Purchases', `‚Çπ${totalPurchases.toFixed(2)}`],
                    ['Gross Margin', `‚Çπ${(totalRevenue - totalPurchases).toFixed(2)}`]
                ];

                const ws = XLSX.utils.aoa_to_sheet(reportData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Report');
                XLSX.writeFile(wb, `Report-${new Date().toISOString().split('T')[0]}.xlsx`);
            };

            return (
                <div>
                    <div className="page-header">
                        <h1 className="page-title">Reports</h1>
                        <p className="page-subtitle">Business analytics</p>
                    </div>

                    <button className="btn btn-success" onClick={exportReport} style={{marginBottom: '24px'}}>
                        üìä Export Report
                    </button>

                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-label">Total Revenue</div>
                            <div className="stat-value">‚Çπ{totalRevenue.toFixed(2)}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Total Purchases</div>
                            <div className="stat-value">‚Çπ{totalPurchases.toFixed(2)}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Gross Margin</div>
                            <div className="stat-value" style={{color: 'var(--success)'}}>
                                ‚Çπ{(totalRevenue - totalPurchases).toFixed(2)}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Backup Component
        function Backup({ products, setProducts, sales, setSales, purchases, setPurchases, suppliers, setSuppliers }) {
            const [importStatus, setImportStatus] = useState('');

            const exportAllData = () => {
                const wb = XLSX.utils.book_new();

                // Products
                const productsData = products.map(p => ({
                    'SKU': p.sku,
                    'Name': p.name,
                    'Category': p.category,
                    'Cost Price': p.costPrice,
                    'Selling Price': p.price,
                    'Quantity': p.quantity,
                    'Unit': p.unit
                }));
                const wsProducts = XLSX.utils.json_to_sheet(productsData);
                XLSX.utils.book_append_sheet(wb, wsProducts, 'Products');

                // Purchases
                const purchasesData = purchases.map(p => ({
                    'Date': new Date(p.date).toLocaleString(),
                    'Supplier': p.supplierName,
                    'Invoice': p.invoiceNo,
                    'Total': p.total,
                    'Payment': p.paymentStatus
                }));
                const wsPurchases = XLSX.utils.json_to_sheet(purchasesData);
                XLSX.utils.book_append_sheet(wb, wsPurchases, 'Purchases');

                // Suppliers
                const suppliersData = suppliers.map(s => ({
                    'Name': s.name,
                    'Contact': s.contactPerson,
                    'Phone': s.phone,
                    'Email': s.email
                }));
                const wsSuppliers = XLSX.utils.json_to_sheet(suppliersData);
                XLSX.utils.book_append_sheet(wb, wsSuppliers, 'Suppliers');

                XLSX.writeFile(wb, `Backup-${new Date().toISOString().split('T')[0]}.xlsx`);
                setImportStatus('‚úÖ Backup exported successfully!');
                setTimeout(() => setImportStatus(''), 3000);
            };

            return (
                <div>
                    <div className="page-header">
                        <h1 className="page-title">Backup & Restore</h1>
                        <p className="page-subtitle">Data management</p>
                    </div>

                    {importStatus && (
                        <div className="alert alert-success">
                            <span>‚ÑπÔ∏è</span>
                            <span>{importStatus}</span>
                        </div>
                    )}

                    <div className="card">
                        <h3 style={{marginBottom: '16px', fontSize: '20px', fontWeight: '600'}}>üíæ Create Backup</h3>
                        <p style={{marginBottom: '20px', color: 'var(--text-muted)'}}>
                            Export all data (products, purchases, suppliers) to Excel.
                        </p>
                        <button className="btn btn-success" onClick={exportAllData}>
                            üì§ Export Complete Backup
                        </button>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
